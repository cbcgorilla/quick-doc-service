<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title th:text="${title}"></title>

    <!-- Metis core stylesheet -->
    <link rel="stylesheet" href="css/app-style.css">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="css/fontawesome-all.min.css">

    <script src="js/bootstrap.min.js"></script>

</head>
<body>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
    <!-- Links -->
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" href="/">文件管理</a>
        </li>
        <li class="nav-item" th:if="${isAdmin}">
            <a class="nav-link" href="/admin">目录管理</a>
        </li>
        <li class="nav-item" th:if="${isAdmin}">
            <a class="nav-link" href="/admin">账号管理</a>
        </li>
        <li class="nav-item" th:if="${isAdmin}">
            <a class="nav-link" href="/admin/swagger-ui">REST API 调用接口</a>
        </li>
            <a class="nav-link" href="/logout">退出系统</a>
        </li>
    </ul>
</nav>

<div id="wrap">
    <div id="content">
        <div class="panel panel-default" th:if="${currentdirectory}">
            <!-- Default panel contents -->
            <div class="panel-heading"><span class="lead">文件上传</span></div>
            <div class="panel-body">
                <div class="table-responsive">
                    <form method="POST" enctype="multipart/form-data" th:action="@{'/uploadFile'}">
                        <table class="table table-hover">
                            <tr>
                                <td align="right">文件分类:</td>
                                <td>
                                    <select id="categoryId" name="categoryId" class="select custome-select">
                                        <option th:each="category : ${allCategories}"
                                                th:value="${category.id}" th:text="${category.type}">文件分类
                                        </option>
                                    </select>
                                </td>
                                <td align="right">需要上传的文件:</td>
                                <td><input type="file" name="file" class="input custom-file"/></td>
                                <td>
                                    <input type="hidden" id="directoryId" name="directoryId"
                                           th:value="${currentdirectory.id}"/>
                                    <input type="hidden" th:name="${_csrf.parameterName}"
                                           th:value="${_csrf.token}"/>
                                    <input type="submit" value="上传文件" class="btn btn-success"/>
                                </td>
                            </tr>
                        </table>
                    </form>
                </div>
            </div>
        </div>

        <div class="alert alert-success" th:if="${message}">
            <h2 th:text="${message}"/>
        </div>

        <div class="panel panel-default">
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>文件名</th>
                        <th>文件长度</th>
                        <th>上传日期</th>
                        <th>文件分类</th>
                        <th>操作</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr th:if="${currentdirectory}">
                        <td colspan="5">
                            <a th:href="@{'/path@'+${currentdirectory.parentId}}"
                               th:text="@{'返回上级目录'}"></a>
                        </td>
                    </tr>
                    <tr th:each="directory : ${directories}">
                        <td>
                            <i th:if="${directory.childrenCount>0}" class="fas fa-folder"></i>
                            <i th:if="${directory.childrenCount==0}" class="far fa-folder"></i>
                            <a th:href="@{'/path@'+${directory.id}}" th:text="${directory.path}"/>
                        </td>
                        <td th:text="@{'文件夹'}" colspan="3"></td>
                        <td>
                            <a th:href="@{'/zip-resource/'+${directory.id}}" th:text="@{'下载此文件夹'}"
                               class="btn btn-success"></a>
                        </td>
                    </tr>
                    <tr th:each="file : ${files}">
                        <form th:action="@{/deleteFile}" th:method="DELETE">
                            <td>
                                <ul th:switch="${file.contentType}">
                                    <li th:case="pdf">
                                        <a th:href="@{'/view-pdf/'+${file.storedId}}">
                                            <i class="far fa-file-pdf"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="gif">
                                        <a th:href="@{'/view-gif/'+${file.storedId}}">
                                            <i class="far fa-file-image"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="jpg">
                                        <a th:href="@{'/view-jpeg/'+${file.storedId}}">
                                            <i class="far fa-file-image"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="jpeg">
                                        <a th:href="@{'/view-jpeg/'+${file.storedId}}">
                                            <i class="far fa-file-image"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="png">
                                        <a th:href="@{'/view-png/'+${file.storedId}}">
                                            <i class="far fa-file-image"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="bmp">
                                        <a th:href="@{'/download/'+${file.storedId}}">
                                            <i class="far fa-file-image"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="tif">
                                        <a th:href="@{'/download/'+${file.storedId}}">
                                            <i class="far fa-file-image"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="tiff">
                                        <a th:href="@{'/download/'+${file.storedId}}">
                                            <i class="far fa-file-image"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="xls">
                                        <a th:href="@{'/download/'+${file.storedId}}">
                                            <i class="far fa-file-excel"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="xlsx">
                                        <a th:href="@{'/download/'+${file.storedId}}">
                                            <i class="far fa-file-excel"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="doc">
                                        <a th:href="@{'/download/'+${file.storedId}}">
                                            <i class="far fa-file-word"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="docx">
                                        <a th:href="@{'/download/'+${file.storedId}}">
                                            <i class="far fa-file-word"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="ppt">
                                        <a th:href="@{'/download/'+${file.storedId}}">
                                            <i class="far fa-file-powerpoint"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="pptx">
                                        <a th:href="@{'/download/'+${file.storedId}}">
                                            <i class="far fa-file-powerpoint"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="txt">
                                        <a th:href="@{'/download/'+${file.storedId}}">
                                            <i class="far fa-file-text"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="mp3">
                                        <a th:href="@{'/download/'+${file.storedId}}">
                                            <i class="far fa-file-audio"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="zip">
                                        <a th:href="@{'/download/'+${file.storedId}}">
                                            <i class="far fa-file-zip"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                    <li th:case="rar">
                                        <a th:href="@{'/download/'+${file.storedId}}">
                                            <i class="far fa-file-zip"></i>
                                            <span th:text="${file.filename}"></span>
                                        </a>
                                    </li>
                                </ul>
                            </td>
                            <td th:text="${file.contentLength}">ID</td>
                            <td th:text="${#dates.format(file.uploadDate,'yyyy-MM-dd HH:mm:ss')}">ID
                            </td>
                            <td th:text="${file.category}">ID</td>
                            <td>
                                <input type="hidden" id="fsDetailId" name="fsDetailId"
                                       th:value="${file.id}"/>
                                <input type="hidden" id="directoryId" name="directoryId"
                                       th:value="${currentdirectory.id}"/>
                                <input type="hidden" th:name="${_csrf.parameterName}"
                                       th:value="${_csrf.token}"/>
                                <input type="submit" value="删除" class="btn btn-danger"/>
                                <a th:href="@{'/download/'+${file.storedId}}" th:text="@{'下载'}"
                                   class="btn btn-success"></a>
                            </td>
                        </form>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- end #content -->
</div><!-- /#wrap -->
<footer>
    <p>2018 &copy; Quick Doc 快捷文档共享</p>
</footer>

</body>
</html>